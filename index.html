<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SD Search</title>
    <link rel="stylesheet" href="style.css">
    <script src="jquery-3.7.1.js"></script>
    <script src="hw2_search_dataset.js"></script>
    <script defer src="script.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fff;
            color: #000;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark-mode {
            background-color: #1e1e1e;
            color: #fff;
        }
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }
        .dark-mode .navbar {
            background: #333;
        }
        .logo {
            font-size: 20px;
            font-weight: bold;
        }
        .search-container {
            display: flex;
            align-items: center;
            border-radius: 20px;
            background: #fff;
            padding: 5px;
            border: 1px solid #ccc;
            width: 100%;
            max-width: 600px; 
            flex-shrink: 1;
        }
        .dark-mode .search-container {
            background: #444;
            border: 1px solid #666;
        }
        #search-box {
            border: none;
            outline: none;
            background: transparent;
            flex: 1;
            padding: 8px;
            font-size: 16px;
        }
        .search-icon {
            cursor: pointer;
            padding: 8px;
        }
        .icons {
            display: flex;
            align-items: center;
        }
        .user-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: gray;
            margin-left: 10px;
            background: url('user_icon.png') no-repeat center/cover;
        }
        main {
            margin-top: 60px;
            padding: 20px;
        }
        .info-bar {
            max-width: 800px; /* è·Ÿ result-container å°é½Š */
            margin: 10px auto; /* ç½®ä¸­ */
            padding: 5px;
        }
        .result-container {
            max-width: 800px;
            margin: 10px auto;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            background: #fff;
        }
        .dark-mode .result-container {
            background: #3a3a3a;
        }
        #results div {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        #load-more {
            display: block;
            margin: 20px auto;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #load-more:disabled {
            display: none;
        }
        #scroll-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            display: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header class="navbar">
        <div class="logo">SD Search</div>
        <div class="search-container">
            <input type="text" id="search-box" placeholder="åœ‹ç«‹ä¸­å¤®å¤§å­¸">
            <span class="search-icon">ğŸ”</span>
        </div>
        <div class="icons">
            <button id="theme-toggle">ğŸŒ</button>
            <div class="user-icon"></div>
        </div>
    </header>
    
    <main>
        <div class="info-bar">
            <span id="result-count">å…±æ‰¾åˆ° 0 ç­†çµæœ</span>
        </div>
        <div class="info-bar">
            <b>æ’åºæ–¹å¼</b>
            <select id="sort-options">
                <option value="title">æŒ‰ç…§æ¨™é¡Œ</option>
                <option value="created_at">æŒ‰ç…§æ™‚é–“</option>
                <option value="popularity">æŒ‰ç…§äººæ°£</option>
            </select>
        </div>
        
        <div id="results"></div>
        
        <button id="load-more">è¼‰å…¥æ›´å¤š</button>
    </main>
    
    <button id="scroll-to-top">â†‘</button>

    <script>
        let currentPage = 0;
        const itemsPerPage = 10;
        let dataset = SEARCH_DATASET;

        function renderResults() {
            $("#results").empty();
            let start = currentPage * itemsPerPage;
            let end = start + itemsPerPage;
            let resultsToShow = dataset.slice(0, end);
            
            resultsToShow.forEach(item => { // è³‡æ–™è™•ç†é¡¯ç¤º
                $("#results").append(`
                    <div class="result-container">
                        <a href="${item.url}" target="_blank"><h3>${item.title}</h3></a>
                        <p>${item.text}</p>
                        <small>${item.created_at} | äººæ°£: ${item.popularity}</small>
                    </div>
                `);
            });
            $("#result-count").text(`å…±æ‰¾åˆ° ${dataset.length} ç­†çµæœ`);
            if (end >= dataset.length) { // è¼‰å…¥æ›´å¤šæŒ‰éˆ•æ¶ˆå¤±
                $("#load-more").prop("disabled", true);
            }
        }

        $("#load-more").click(function() {
            currentPage++;
            renderResults();
        });

        $(".search-icon").click(function() {
            search();
        });

        $("#search-box").keypress(function(event) {
            if (event.which === 13) {
                search();
            }
        });

        function search() { // æœå°‹åŠŸèƒ½(é»æ“Šæ”¾å¤§é¡ã€Enter)
            let query = $("#search-box").val().toLowerCase();
            dataset = SEARCH_DATASET.filter(item => item.title.toLowerCase().includes(query) || item.text.toLowerCase().includes(query));
            currentPage = 0;
            renderResults();
        }

        $("#sort-options").change(function() {
            let sortBy = $(this).val();
            dataset.sort((a, b) => {
                if (sortBy === "title") return a.title.localeCompare(b.title);
                if (sortBy === "created_at") return new Date(b.created_at) - new Date(a.created_at);
                if (sortBy === "popularity") return b.popularity - a.popularity;
            });
            currentPage = 0;
            renderResults();
        });

        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $("#scroll-to-top").fadeIn();
            } else {
                $("#scroll-to-top").fadeOut();
            }
        });
        
        $("#scroll-to-top").click(function() {
            $("html, body").animate({ scrollTop: 0 }, "slow");
        });
        
        $("#theme-toggle").click(function() {
            $("body").toggleClass("dark-mode");
            $(this).text($("body").hasClass("dark-mode") ? "ğŸŒ™" : "ğŸŒ");
        });
        
        $(document).ready(function() {
            renderResults();
        });
    </script>
</body>
</html>
